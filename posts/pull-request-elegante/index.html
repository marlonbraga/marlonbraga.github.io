<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Fazendo Pull Requests elegantes | Marlon Braga</title> <meta name="author" content="Marlon Braga"> <meta name="description" content="O que devemos escrever na descrição de nosso PR?"> <meta name="keywords" content="developer, programmer, software, coder, engineer, dotnet, c-sharp, c#"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700%7CRoboto+Slab:100,300,400,500,700%7CMaterial+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%91%A8%F0%9F%8F%BB%E2%80%8D%F0%9F%92%BB&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://marlonbraga.github.io/posts/pull-request-elegante/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/monokai.css" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Marlon </span>Braga</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">Posts</a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">Repositories</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">Curriculum Vitae</a> </li> <li class="nav-item "> <a class="nav-link" href="/_pages/buymeacoffee/">Buy me a coffee</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container-lg mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Fazendo Pull Requests elegantes</h1> <p class="post-meta">February 16, 2023</p> <p class="post-tags"> <a href="/blog/2023"> <i class="fas fa-calendar fa-sm"></i> 2023 </a>   ·   <a href="/blog/tag/formatting"> <i class="fas fa-hashtag fa-sm"></i> formatting</a>   <a href="/blog/tag/code"> <i class="fas fa-hashtag fa-sm"></i> code</a>     ·   <a href="/blog/category/sample-posts"> <i class="fas fa-tag fa-sm"></i> sample-posts</a>     ·   <a href="/posts/elegant-pull-request/" class="en"><i class="fas fa-language fa-sm"></i> en</a>    <a href="/posts/pull-request-elegante/" class="pt-br" style="pointer-events: none"><i class="fas fa-language fa-sm"></i> pt-br</a>    </p> </header> <article class="post-content"> <p>A revisão de código alheio pode ser uma tarefa ingrata. Principalmente quando contém uma grande quantidade de alterações.</p> <p>O ideal é sempre optar por pull-requests pequenos. Porém isso bem sempre é possível.</p> <p>Nesses casos, podemos facilitar a vida da infeliz criatura que terá de revisar essa quantidade quase infinita de mudanças em um código. Afinal de contas, não queremos que erros entrem na branch principal do nosso repositório e esse código não foi escrito por ele.</p> <p>Um bom Reademe pode ser útil nessa tarefa. Mas o que seria revante colocar em uma descrição de Pull Request?</p> <h2 id="objetivo">Objetivo</h2> <p>Por que foi necessário criar esse PR? Que problemas ele resolve?</p> <ul> <li>Print se tiver uma interface gráfica</li> <li>Link da estória de usuário/requisito funcional/caso de uso</li> </ul> <p>Ex.:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>O objetivo dessas alterações é a refatoração da classe `GameService` .
Mais especificamente, o método `SaveGame`.
</code></pre></div></div> <h2 id="decisões-de-design">Decisões de design</h2> <p>Mas por quê precisava criar uma classe nova em vez de usar a existente? Por quê separar um trecho de código de uma classe? Precisava mesmo de tanta interface assim? Porque essas classes novas estão nesse diretório e não na pasta raiz?</p> <p>Não. Os revisores de código não são adivinhos. A decisões de design de código não são óbvias e não seria elegante deixar ele gastar tempo tentando decifrar escolhas que você poderia escrever com poucos caracteres. O que é relevante é o seguinte:</p> <ul> <li>Quais Interfacesm classes ou métodos foram aleterados/criados</li> <li>Qual foi o objetivo em realizar cada alteração?</li> <li>Quais descições foram tomadas</li> <li>Qual o princípio de design que foi considerado para tomar essa decisão? SOLID?</li> </ul> <p>Um diagrama de classes básico, pode economizar um tempo precioso se quiser realmente que entendam o que você fez.</p> <p>Ex.:</p> <blockquote> <p>Para permitir a criação de testes unitários, foi necessário adequar a classe ao princípio de Inversão de controle (SOLID). Todas as chamadas ao contexto do banco de dados foi removida da classe service para novas classes de DAO <code class="language-plaintext highlighter-rouge">CreatureRepository</code> , <code class="language-plaintext highlighter-rouge">PlayersRepository</code>, <code class="language-plaintext highlighter-rouge">ExperiencePointsRepository</code>. A classe <code class="language-plaintext highlighter-rouge">DungeonBuilderService</code> passa a depender de suas abstrações possibilitando o desacoplamento necessário para realização de testes unitários.</p> </blockquote> <p><img src="/assets/img/2023-02-16-pull-request-elegante/class-diagram.png" alt="Diagrama de clases"></p> <h2 id="métricas-de-qualidade-de-código">Métricas de Qualidade de código</h2> <p>Dê segurança ao revisor de você se importou manter seu código manutenível em vez de sair bagunçando tudo só para entregar a tarefa mais rápido.</p> <p>Os fatos não se importam com a opinião de ninguém. Métricas dizem os fatos e atropelam a opinião de seus revisores mais implicantes. É uma forma de contornar a objeção relacionadas a “estilo de escrita”. Afinal de contas, deve-se sacrificar nosso índice de manutenibilidade do código por causa de um capricho do revisor? Será que preferências estéticas tem tanta importância quando a uma queda no acoplamento na classe tal ou um método que nasceu com baixa complexidade cognitiva? Obs.: (Se seu código estiver ferindo nenhum acordo ou padrão pré-estabelecido pelo time, não é uma questão de opinião. Você deve altera-lo sim)</p> <p>Um print do Code Analyser do Visual Studio é bem-vindo. Mas uma tabela simples serve.</p> <p>Ex.:</p> <blockquote> <p>Código resultante demonstrou maior legibilidade.<br> - Aumento de Índice de manutenabilidade <em>(de 24 para 51)</em><br> - Diminuição de Acoplamento de Classes <em>(de 16 para 10)</em><br> - Redução de Complexidade ciclomática <em>(de 47 para 5)</em><br> - Redução de linhas de código <em>(de 133 para 35)</em></p> <p>Parte dessa melhora se deu por causa da <em>extração de método</em> criando o <code class="language-plaintext highlighter-rouge">ConverterModelParaEntidade()</code>.</p> </blockquote> <table> <thead> <tr> <th><strong>MÉTRICA</strong></th> <th style="text-align: center"><strong>INDICADOR</strong></th> <th style="text-align: center"><strong>COMPARATIVO</strong></th> </tr> </thead> <tbody> <tr> <td>Índice de Manutenibilidade</td> <td style="text-align: center">51</td> <td style="text-align: center">+ 27%</td> </tr> <tr> <td>Complexidade Ciclimática</td> <td style="text-align: center">5</td> <td style="text-align: center">- 42%</td> </tr> <tr> <td>Acoplamento de Classes</td> <td style="text-align: center">0</td> <td style="text-align: center">- 6%</td> </tr> <tr> <td>Linhas de código</td> <td style="text-align: center">35</td> <td style="text-align: center">- 98</td> </tr> </tbody> </table> <p><img src="/assets/img/2023-02-16-pull-request-elegante/code-metrics.png" alt="Code_metrics"></p> <p>Para um profissional de código, é melhor ser reconhecido pela qualidade do meu trabalho do que a velocidade com a que entrego. Essa é uma ótima forma de mostrar.</p> <h2 id="testes">Testes</h2> <p>Sim. É necessário saber se isso está funcionando e se está quebrando algo. Executar testes automatizados são úteis para mostrar que você fez o mínimo esperado de você. Mas uma análise mais detalhada pode dar um panomora geral sobre a qualidade especificamente do que você fez. Algumas informações importantes são:</p> <ul> <li>Quantos testes automatizados foram criados</li> <li>Qual é a porcentagem da cobertura de código alterado</li> <li>Quantos fluxos de código estão sendo testados</li> <li>Variação de Performance</li> <li>Quais testes manuais foram executados</li> </ul> <p>Ex.:</p> <blockquote> <ul> <li>2 novos testes unitário criados</li> <li>Cobertura de todos os fluxos de código do método em questão (2/2)</li> <li>100% de cobertura de código no método em questão</li> <li>Aumento de cobetura de código em métodos relacionados</li> </ul> </blockquote> <p><img src="/assets/img/2023-02-16-pull-request-elegante/code-coverage.png" alt="code-coverage"></p> <h2 id="integração">Integração</h2> <p>As vezes a alteração não é com o código mas com a alteração em si e o quanto isso pode afetar a estabilidade do sitema em funcionamento.</p> <ul> <li>Impacta outras áreas</li> <li>Impacta sistemas já em funcionamento?</li> <li>Há alguma configuração no sistema aser feita?</li> </ul> <hr> <h2 id="template-de-pr">Template de PR:</h2> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>O objetivo dessas alterações é __________.

### **📐Decisões de design**
Para permitir a criação de testes unitários, foi necessário adequar a classe ao princípio de **Inversão de controle (SOLID)** .
Todas as chamadas ao contexto do banco de dados foi removida da classe service para novas classes DAO `______` , `______`, `______`. A classe `ResgatesAgendadosService` passa a depender de suas abstrações possibilitando desacoplamento necessário para realização de testes unitários.

![Diagrama de clases](image.jpg)

### **🌡️Qualidade de código**
Código resultante demonstrou maior legibilidade.  
	- Aumento de Índice de manutenabilidade  
	- Diminuição de Acoplamento de Classes  
	- Redução de Complexidade ciclomática  
	- Redução de linhas de código  
Parte dessa melhora se deu por causa da *extração de método* criando o ` ______()`.

![Code_metrics](image.png)  
| **MÉTRICA**                | **INDICADOR** | **EVOLUÇÃO** |
| -------------------------- |:-------------:|:------------:|
| Complexidade Cognitiva     | 10%           | + 100%       |
| Complexidade Ciclimática   | 1             | + 100%       | 
| Profundidade de herança    | 0             | - 100%       |
| Índice de Manutenibilidade | 100           | + 100%       |
| Acoplamento de Classes     | 0             | - 100%       |
| Linhas de código           | 1000          | + 100%       |

### **🧪Testes Automatizados**
  - ___ novos testes unitários criados
  - Cobertura de todos os fluxos de código do método em questão (___/___)
  - ___% de cobertura de código no método em questão
  - Aumento de cobetura de código em métodos relacionados
	
![testes](image.png)

Cobertura
![code-cov](image.png)

</code></pre></div></div> <h2 id="pr-template">PR Template:</h2> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The purpose of these changes is __________.

# **📐Design Decisions**
To allow the creation of unit tests, it was necessary to adapt the class to the principle of **Inversion of control (SOLID)** .
All database context calls have been removed from the service class for new DAO classes `______` , `______`, `______`. The `ResgatesAgendadosService` class starts to depend on its abstractions, allowing the necessary decoupling to carry out unit tests.

![Class diagram](image.jpg)

# **🌡️Code quality**
Resulting code demonstrated greater readability.
- Increased maintainability index
- Decreased Coupling of Classes
- Reduction of Cyclomatic Complexity
- Reduction of lines of code
Part of this improvement was due to *method extraction* creating ` ______()`.

![Code_metrics](image.png)
| **METRIC** | **INDICATOR** | **EVOLUTION** |
| -------------------------- |:-------------:|:------ ------ :|
| Cognitive Complexity | 10% | + 100% |
| Cyclimatic Complexity | 1 | + 100% |
| Inheritance Depth | 0 | - 100% |
| Maintainability Index | 100 | + 100% |
| Class Coupling | 0 | - 100% |
| Lines of code | 1000 | + 100% |

# **🧪Automated Tests**
   - ___ new unit tests created
   - Coverage of all code streams of the method in question (___/___)
   - ___% code coverage on the method in question
   - Increased code coverage in related methods

![tests](image.png)

Coverage
![code-cov](image.png)

</code></pre></div></div> </article> <br> <br> <br> <br> <br> <br> <br> <br><div id="disqus_thread" style="max-width: 800px; margin: 0 auto;"> <script type="text/javascript">var disqus_shortname="marlonbraga-1",disqus_identifier="/posts/pull-request-elegante",disqus_title="Fazendo Pull Requests elegantes";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}();</script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by Disqus.</a> </noscript> </div> <script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="marlonbraga" data-description="Support me on Buy me a coffee!" data-message="" data-color="#0073DF" data-position="Right" data-x_margin="18" data-y_margin="18"></script> </div> </div> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="/assets/js/common.js"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="marlonbraga" data-description="Support me on Buy me a coffee!" data-message="" data-color="#0073DF" data-position="Right" data-x_margin="18" data-y_margin="18"></script> </body> </html>