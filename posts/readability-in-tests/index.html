<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Readability in unit tests | Marlon Braga</title> <meta name="author" content="Marlon Braga"> <meta name="description" content="Tips to increase the readability of unit tests"> <meta name="keywords" content="developer, programmer, software, coder, engineer, dotnet, c-sharp, c#"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700%7CRoboto+Slab:100,300,400,500,700%7CMaterial+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%91%A8%F0%9F%8F%BB%E2%80%8D%F0%9F%92%BB&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://marlonbraga.github.io/posts/readability-in-tests/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/monokai.css" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Marlon </span>Braga</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">Posts</a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">Repositories</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">Curriculum Vitae</a> </li> <li class="nav-item "> <a class="nav-link" href="/_pages/buymeacoffee/">Buy me a coffee</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container-lg mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Readability in unit tests</h1> <p class="post-meta">February 4, 2023</p> <p class="post-tags"> <a href="/blog/2023"> <i class="fas fa-calendar fa-sm"></i> 2023 </a>   ·   <a href="/blog/tag/test"> <i class="fas fa-hashtag fa-sm"></i> test</a>   <a href="/blog/tag/code"> <i class="fas fa-hashtag fa-sm"></i> code</a>     ·   <a href="/blog/category/sample"> <i class="fas fa-tag fa-sm"></i> sample</a>   <a href="/blog/category/posts"> <i class="fas fa-tag fa-sm"></i> posts</a>     ·   <a href="/posts/readability-in-tests/" class="en" style="pointer-events: none"><i class="fas fa-language fa-sm"></i> en</a>    <a href="/posts/legibilidade-em-testes/" class="pt-br"><i class="fas fa-language fa-sm"></i> pt-br</a>    </p> </header> <article class="post-content"> <h2 id="why-readability-and-tests">Why readability and tests?</h2> <p>Unit testing is more than automatic code validation. It also serves as documents showing what to expect and what not to expect from the method’s behavior.</p> <p>That’s why it’s especially interesting that the code is <strong>readable</strong>.</p> <p>Furthermore, unit tests are also code. Therefore, they are also sustaining maintenance. This maintenance should be as simple and fast as any other piece of code in the solution.</p> <h2 id="nomenclature">Nomenclature</h2> <p>Names matter in testicles too. During test suite execution, it is the name of the test method that will be displayed next to a pass or fail message.</p> <p><img src="/assets/img/2023-02-04-legibilidade-em-testes/execution_suit_tests.png" alt="Test Suite"></p> <p>The most readable way to name a test is the Given/When/Then pattern.</p> <p>Being that <code class="language-plaintext highlighter-rouge">Given</code> is a precondition. <code class="language-plaintext highlighter-rouge">When</code> is an action. <code class="language-plaintext highlighter-rouge">So</code> is an expected result.</p> <p>Ex:</p> <div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="n">fact</span> <span class="n">that</span><span class="p">]</span>
<span class="k">void</span> <span class="nf">BankAccount_Transfer_BalanceIsReduced</span><span class="p">(){</span>
      <span class="c1">//...</span>
<span class="p">}</span>
</code></pre></div></div> <p>It is not necessary to go into too much detail. This is the name of the test. If you want to know details, read his code.</p> <h2 id="test-cleaning">Test cleaning</h2> <blockquote> <p>What makes a test clean? Three things: readability, readability and readability. (…) What makes the testicles readable? The same thing that makes all codes readable: clarity, simplicity and consistency of expression. In a test you want to say a lot with as few expressions as possible.</p> <p>– Uncle Bob, Clean Code</p> </blockquote> <h3 id="one-assertion-per-test">One assertion per test</h3> <p>Tests that come to a single conclusion are easier to understand.</p> <h3 id="one-single-concept-per-test">One single concept per test</h3> <p>One test for each example specification. We don’t want long methods that test several things one after the other.</p> <h2 id="code-structure">Code structure</h2> <p>Despite being intuitive, the AAA (Arrange-Act-Assert) pattern remains a great form of organization within the test method. The idea is that the <code class="language-plaintext highlighter-rouge">preparation of the test</code> piece of code is separated from the <code class="language-plaintext highlighter-rouge">performing the test</code> piece of code from the <code class="language-plaintext highlighter-rouge">test verification</code> piece. In practice, the coder knows where everything is without even starting to read the code.</p> <div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// arrange</span>
<span class="kt">var</span> <span class="n">repository</span> <span class="p">=</span> <span class="n">Substitute</span><span class="p">.</span><span class="n">For</span><span class="p">&lt;</span><span class="n">IClientRepository</span><span class="p">&gt;();</span>
<span class="kt">var</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Client</span><span class="p">(</span><span class="n">repository</span><span class="p">);</span>
<span class="c1">// act</span>
<span class="n">client</span><span class="p">.</span><span class="nf">Save</span><span class="p">();</span>
<span class="c1">// assert</span>
<span class="n">mock</span><span class="p">.</span><span class="n">Received</span><span class="p">.</span><span class="nf">SomeMethod</span><span class="p">();</span>
</code></pre></div></div> <h2 id="tools">Tools</h2> <p>There are some tools that can help you achieve the desired readability.</p> <ul> <li><a href="https://www.nuget.org/packages/NSubstitute" rel="external nofollow noopener" target="_blank">NSustitute</a></li> <li><a href="https://www.nuget.org/packages/FluentAssertions" rel="external nofollow noopener" target="_blank">FluentAssetion</a></li> </ul> <h3 id="substitute">Substitute</h3> <p><strong>NSustitute</strong> is an alternative to <strong>Moq</strong>. With it, reading and writing the most common codes are closer to natural language. Moq is a good mocking tool in several ways. But test readability is not one of them.</p> <p>While Moq makes use of the lambda operation for the simplest situations, a mock written with NSubstitute comes closer to natural language.</p> <div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//❌with Moq</span>
<span class="n">mockUser</span><span class="p">.</span><span class="nf">Setup</span><span class="p">(</span><span class="n">foo</span> <span class="p">=&gt;</span> <span class="n">foo</span><span class="p">.</span><span class="n">Address</span><span class="p">.</span><span class="n">Street</span><span class="p">).</span><span class="nf">Returns</span><span class="p">(</span><span class="n">street</span><span class="p">);</span>
<span class="n">mock</span><span class="p">.</span><span class="nf">Setup</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="nf">SearchById</span><span class="p">(</span><span class="n">It</span><span class="p">.</span><span class="n">IsAny</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;())).</span><span class="nf">Returns</span><span class="p">((</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">userList</span><span class="p">.</span><span class="nf">Skip</span><span class="p">(</span><span class="m">1</span><span class="p">).</span><span class="nf">Take</span><span class="p">(</span><span class="m">1</span><span class="p">).</span><span class="nf">First</span><span class="p">());</span>
<span class="n">mock</span><span class="p">.</span><span class="nf">Setup</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="nf">SearchById</span><span class="p">(</span><span class="m">2</span><span class="p">)).</span><span class="nf">Returns</span><span class="p">((</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">userList</span><span class="p">.</span><span class="nf">First</span><span class="p">());</span>

<span class="c1">//✔️with NSubstitute</span>
<span class="n">mockUser</span><span class="p">.</span><span class="n">Address</span><span class="p">.</span><span class="n">Street</span><span class="p">.</span><span class="nf">Returns</span><span class="p">(</span><span class="n">street</span><span class="p">);</span>
<span class="n">mock</span><span class="p">.</span><span class="nf">SearchById</span><span class="p">(</span><span class="n">Arg</span><span class="p">.</span><span class="n">Any</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;()).</span><span class="nf">Returns</span><span class="p">(</span><span class="n">userList</span><span class="p">.</span><span class="nf">Skip</span><span class="p">(</span><span class="m">1</span><span class="p">).</span><span class="nf">Take</span><span class="p">(</span><span class="m">1</span><span class="p">).</span><span class="nf">First</span><span class="p">();</span>
<span class="n">mock</span><span class="p">.</span><span class="nf">SearchById</span><span class="p">(</span><span class="m">2</span><span class="p">).</span><span class="nf">Returns</span><span class="p">(</span><span class="n">userList</span><span class="p">.</span><span class="nf">First</span><span class="p">());</span>
</code></pre></div></div> <h3 id="fluent-assessment">Fluent Assessment</h3> <p><strong>FluentAssetion</strong> is an alternative to <strong>System.Assert</strong>. This package follows the same idea as the previous one. However treated for the Assert phase of the test.</p> <p>The highlight is on the name of the methods. When combined, reading is fluid exactly as you would read a business rule in English.</p> <div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//❌with Assert</span>
<span class="n">actual</span> <span class="kt">string</span> <span class="p">=</span> <span class="s">"ABCDEFGHI"</span><span class="p">;</span>
<span class="n">Assert</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="s">"EF"</span><span class="p">,</span> <span class="n">real</span><span class="p">);</span>
<span class="n">Assert</span><span class="p">.</span><span class="nf">StartsWith</span><span class="p">(</span><span class="s">"EF"</span><span class="p">,</span> <span class="n">real</span><span class="p">);</span>
<span class="n">Assert</span><span class="p">.</span><span class="nf">AreEqual</span><span class="p">(</span><span class="m">9</span><span class="p">,</span> <span class="n">real</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>

<span class="c1">//✔️with FluentAssetion</span>
<span class="n">actual</span> <span class="kt">string</span> <span class="p">=</span> <span class="s">"ABCDEFGHI"</span><span class="p">;</span>
<span class="n">real</span><span class="p">.</span><span class="nf">Should</span><span class="p">().</span><span class="nf">StartWith</span><span class="p">(</span><span class="s">"AB"</span><span class="p">).</span><span class="n">And</span><span class="p">.</span><span class="nf">EndWith</span><span class="p">(</span><span class="s">"HI"</span><span class="p">).</span><span class="n">And</span><span class="p">.</span><span class="nf">Contain</span><span class="p">(</span><span class="s">"EF"</span><span class="p">).</span><span class="n">And</span><span class="p">.</span><span class="nf">HaveLength</span><span class="p">(</span><span class="m">9</span><span class="p">);</span>
</code></pre></div></div> <p>package manager</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NuGet\Install-Package NSubstitute -Version 4.4.0
NuGet\Install-Package NSubstitute.Analyzers.CSharp -Version 1.0.16
NuGet\Install-Package FluentAssertions -Version 6.9.0

</code></pre></div></div> <h2 id="why-not-use-specflow">Why not use SpecFlow?</h2> <p>It’s like the saying goes:</p> <blockquote> <p>“For those who only know how to use a hammer, every problem is a nail.”</p> </blockquote> <p>SpecFlow is a very interesting and useful tool. However, it is productive when used for the purpose for which it was created. When it runs away from it, it gets in the way more than it helps.</p> <p>SpecFlow is a BDD tool. This consists of making specifications by example with <strong>Gherkin</strong>, a common language for QA, Developer and PO. This is very useful in an <em>End-To-End test</em> and even an <em>Integrated test</em>. But the <em>unit test</em> is made and maintained only by the Developer. Therefore, it is necessary that the language of a unit test is more technical. Using Gherkin to describe functionality in a technical language is more counterproductive than using traditional tests.</p> <p>But let’s talk more about <strong>BDD+Specflow</strong> in another opportunity.</p> <p>The idea is that, for now, we leave SpecFlow out of our unit tests.</p> </article> <br> <br> <br> <br> <br> <br> <br> <br><div id="disqus_thread" style="max-width: 800px; margin: 0 auto;"> <script type="text/javascript">var disqus_shortname="marlonbraga-1",disqus_identifier="/posts/readability-in-tests",disqus_title="Readability in unit tests";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}();</script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by Disqus.</a> </noscript> </div> <script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="marlonbraga" data-description="Support me on Buy me a coffee!" data-message="" data-color="#0073DF" data-position="Right" data-x_margin="18" data-y_margin="18"></script> </div> </div> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="/assets/js/common.js"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="marlonbraga" data-description="Support me on Buy me a coffee!" data-message="" data-color="#0073DF" data-position="Right" data-x_margin="18" data-y_margin="18"></script> </body> </html>